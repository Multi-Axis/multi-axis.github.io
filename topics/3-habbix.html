<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Multi-Axis - Habbix</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Multi-Axis Documentation</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
            </div>
        </div>
        <div id="content">
            <h1>Habbix</h1>
            <div class="info">
    
</div>

<h2 id="configuration">Configuration</h2>
<p>Copy the file <code>config.default.yaml</code> to <code>./config.yaml</code> and edit the parameters in it.</p>
<p>We require access to two databases, our own “local” database and the zabbix, “remote”, database <strong>Make sure both databases are reachable.</strong> Although most commands use only the local db. The only exceptions are <code>sync</code> (both) and <code>trend</code> (remote only) commands.</p>
<h3 id="crontab">Crontab</h3>
<pre class="crontab"><code>
# Sync only trends and history
*/5 * * * * sh -c 'cd /home/ohtu &amp;&amp; .cabal/bin/habbix sync -q'

# Sync new hosts too, and add them a default future
*/30 * * * * sh -c 'cd /home/ohtu &amp;&amp; .cabal/bin/habbix sync --syncall -q'</code></pre>
<h2 id="usage">Usage</h2>
<p>Running <code>habbix --help</code>:</p>
<pre><code>habbix [COMMAND] ... [OPTIONS]

Commands:
  hosts      List all hosts and groups except templates
  apps       List available &quot;metric groups&quot; for the Host ID
  items      List available &quot;metrics&quot; in the metric group App ID&gt;
  history    Print history data for &lt;itemid&gt;
  trends     Print trend data for the REMOTE item
  future     List all item futures
  models     List available future models
  migratedb  Create or update the local DB schema
  sync       Synchronize remote db with local and run futures
  configure  Configure the predictions in database
  execute    Execute item_future.ID but only output the results, instead of
             modifying database
  compare    Compare predictions from knowing A to an actual history B

Common flags:
  -c --config=FILE       yaml config file (default: ./config.yaml)
  -h --human --outhuman  Human-readable JSON output
  -j --json --outjson    Bare JSON output
  -? --help              Display help message
  -V --version           Print version information
  -v --verbose           Loud verbosity
  -q --quiet             Quiet verbosity</code></pre>
<p>Habbix subcommands can be broken up into categories:</p>
<ul>
<li>Modify the database (<code>migratedb sync configure</code>)</li>
<li>Just fetch info from database (<code>hosts apps items history future models</code>)</li>
<li>Forecasting (does <em>not</em> modify the db in any way) (<code>execute compare</code>)</li>
</ul>
<p>Run <code>habbix subcommand --help</code> to see additional parameters.</p>
<p>STDOUT is always json and by default formatted human-readable (<code>--human</code>). You can output bare json without newlines with (<code>--json</code>).</p>
<h3 id="habbix-migratedb"><code>habbix migratedb</code></h3>
<p>Creates the local database schema. (Or migrates if it exists already)</p>
<h3 id="habbix-sync"><code>habbix sync</code></h3>
<p>Populate or update local db with data from remote db: <code>habbix sync</code>.</p>
<p>Update the future of a specific item_future.id: <code>habbix sync -i 2</code>.</p>
<p>Careful with the populate/update outputs when running with –<code>verbose</code>! There is a lot of sql debug msgs.</p>
<h3 id="habbix-trend"><code>habbix trend</code></h3>
<p>This command uses the <strong>remote</strong> database and outputs an sql transaction that can be used to insert a data set into some other table. It outputs the transaction to stdout. Example:</p>
<pre class="shell"><code>$ habbix trends 23687 \       # replace number with an items.itemid in zabbix db
     --sql \                  # required. output as a transaction
     --config myconfig.yaml \ # optional. set some other config that ./config.yaml
     --asitem 1 --ashost 1    # required. itemid and hostid used in the output (only)
BEGIN;
INSERT INTO hosts VALUES (1, 'ohtu1', 0, 1, 'ohtu1');
INSERT INTO items VALUES (1, 0, 1, 'CPU $2 time', 'system.cpu.util[,idle]', 'The time the CPU has spent doing nothing.', '0');
INSERT INTO trend VALUES 
   (1, 1410501600, 94.0244, 98.8033, 99.2991),
   (1, 1410505200, 98.8481, 99.0174, 99.1656),
   (1, 1410508800, 98.7310, 99.0362, 99.2322),
   ...
COMMIT;</code></pre>
<p>You can pipe the output straight to <code>psql</code> or to a file first.</p>
<h2 id="futures">Futures</h2>
<p>History synchronization is done for items present in the <code>item_future</code> table. You need to add items to this table yourself. Note that we couple history with future: when adding an <code>item</code> to be synced, you must specify a future prediction model for it.</p>
<p>Available prediction models are stored in <code>future_model</code> table. <code>future_model.name</code> describes a binary in <code>$PWD/forecast_models/$future_model.name</code>, that gets executed every time a synchronization is done. The prediction program is fed a <code>Event</code> JSON object in its standard input, and a <code>Result</code> JSON object is expected as standard output.</p>
<h2 id="static-linking">Static linking?</h2>
<p>Very tricky, because haskell package <code>postgresql-libpq</code> requires <code>pq</code> library which requires <code>krb5</code> library, and linking (recentish) <code>krb5</code> statically is unsupported and won’t work.</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
